name: PR Impact Visualization

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - 'src/**/*.ts'
      - 'src/**/*.tsx'
      - 'src/**/*.js'
      - 'src/**/*.jsx'

permissions:
  contents: read
  pull-requests: write

jobs:
  visualize-impact:
    name: Visualize PR Impact
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch base branch
        run: |
          git fetch origin ${{ github.event.pull_request.base.ref }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Get changed files
        id: changed-files
        run: |
          CHANGED_FILES=$(git diff --name-only origin/${{ github.event.pull_request.base.ref }}...HEAD | grep -E '\.(ts|tsx|js|jsx)$' | grep '^src/' || true)
          echo "files<<EOF" >> $GITHUB_OUTPUT
          echo "$CHANGED_FILES" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

          CHANGED_COUNT=$(echo "$CHANGED_FILES" | grep -v '^$' | wc -l | tr -d ' ')
          echo "count=$CHANGED_COUNT" >> $GITHUB_OUTPUT

      - name: Run impact analysis
        id: impact-analysis
        if: steps.changed-files.outputs.count > 0
        env:
          BASE_BRANCH: ${{ github.event.pull_request.base.ref }}
        run: |
          node scripts/visualize-pr-impact.mjs

      - name: Read impact report
        id: read-report
        if: steps.changed-files.outputs.count > 0
        run: |
          if [ -f pr-impact.md ]; then
            {
              echo 'report<<EOF'
              cat pr-impact.md
              echo 'EOF'
            } >> $GITHUB_OUTPUT

            # Extract summary for AI review
            CHANGED_COUNT="${{ steps.changed-files.outputs.count }}"
            CHANGED_FILES=$(cat pr-impact.md | sed -n '/## ë³€ê²½ëœ íŒŒì¼/,/## ì˜í–¥ë°›ëŠ” íŒŒì¼/p' | grep '^- `' | sed 's/^- `//;s/`$//')
            IMPACTED_FILES=$(cat pr-impact.md | sed -n '/## ì˜í–¥ë°›ëŠ” íŒŒì¼/,$p' | grep '^- `' | sed 's/^- `//;s/`$//')
            IMPACTED_COUNT=$(echo "$IMPACTED_FILES" | grep -v '^$' | wc -l | tr -d ' ')

            {
              echo 'impact_summary<<EOF'
              echo "ë³€ê²½ëœ íŒŒì¼ ìˆ˜: ${CHANGED_COUNT}ê°œ"
              echo "ì˜í–¥ë°›ëŠ” íŒŒì¼ ìˆ˜: ${IMPACTED_COUNT}ê°œ"
              echo ""
              echo "ë³€ê²½ëœ íŒŒì¼:"
              echo "$CHANGED_FILES"
              echo ""
              if [ ! -z "$IMPACTED_FILES" ]; then
                echo "ì˜í–¥ë°›ëŠ” íŒŒì¼:"
                echo "$IMPACTED_FILES"
              fi
              echo 'EOF'
            } >> $GITHUB_OUTPUT
          fi

      - name: Generate AI-powered impact analysis
        if: steps.changed-files.outputs.count > 0 && steps.read-report.outputs.impact_summary != ''
        id: ai-analysis
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          IMPACT_SUMMARY: ${{ steps.read-report.outputs.impact_summary }}
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          if [ -z "$GEMINI_API_KEY" ]; then
            echo "âš ï¸ GEMINI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            echo "ì˜í–¥ ë²”ìœ„ ì‹œê°í™”ë§Œ ì œê³µë©ë‹ˆë‹¤."
            echo "ai_advice=" >> $GITHUB_OUTPUT
            exit 0
          fi

          # Create Python script for API call
          cat > /tmp/call_gemini.py << 'PYTHON_SCRIPT'
          import os
          import json
          import urllib.request

          api_key = os.environ['GEMINI_API_KEY']
          impact_summary = os.environ['IMPACT_SUMMARY']
          pr_title = os.environ['PR_TITLE']

          prompt = f"""ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ React/TypeScript ì‹œë‹ˆì–´ ê°œë°œìì…ë‹ˆë‹¤.
ì½”ë“œ ë¦¬ë·° ê²½í—˜ì´ í’ë¶€í•˜ë©°, ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤.

=== Pull Request ì •ë³´ ===
ì œëª©: {pr_title}

=== ì˜í–¥ ë²”ìœ„ ë¶„ì„ ê²°ê³¼ ===
{impact_summary}

ìœ„ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì•„ë˜ 4ê°€ì§€ ê´€ì ì—ì„œ **ë§¤ìš° êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì´ë©° ìƒì„¸í•œ** ì¡°ì–¸ì„ ì œê³µí•´ì£¼ì„¸ìš”.

**âš ï¸ ì¤‘ìš”: ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ì‘ì„± ê·œì¹™ âš ï¸**
1. ê° ì„¹ì…˜ë§ˆë‹¤ **ìµœì†Œ 8-10ë¬¸ì¥ ì´ìƒ** ì‘ì„±í•˜ì„¸ìš” (ì§§ì€ ì‘ë‹µì€ ì ˆëŒ€ ë¶ˆê°€)
2. ë°˜ë“œì‹œ **êµ¬ì²´ì ì¸ íŒŒì¼ëª…ê³¼ ê²½ë¡œ**ë¥¼ ì—¬ëŸ¬ ê°œ ì–¸ê¸‰í•˜ì„¸ìš”
3. **ì‹¤ì œë¡œ í™•ì¸í•´ì•¼ í•  êµ¬ì²´ì ì¸ ì½”ë“œ ìœ„ì¹˜, í•¨ìˆ˜ëª…, Propsëª…**ì„ ì–¸ê¸‰í•˜ì„¸ìš”
4. ì¶”ìƒì ì´ê±°ë‚˜ ì¼ë°˜ì ì¸ ì¡°ì–¸ì€ ì ˆëŒ€ ì‘ì„±í•˜ì§€ ë§ˆì„¸ìš”
5. "~í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" ë³´ë‹¤ "~í•´ì•¼ í•©ë‹ˆë‹¤", "~ë¥¼ í™•ì¸í•˜ì„¸ìš”" ì²˜ëŸ¼ ëª…í™•í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”
6. ê° ì„¹ì…˜ì—ì„œ ìµœì†Œ 3-4ê°œì˜ êµ¬ì²´ì ì¸ ì˜ˆì‹œë‚˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì œì‹œí•˜ì„¸ìš”
7. ì½”ë“œ ì˜ˆì‹œë‚˜ êµ¬ì²´ì ì¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ í¬í•¨í•˜ì„¸ìš”

---

### ğŸ§ª í…ŒìŠ¤íŠ¸ ë²”ìœ„ (ìµœì†Œ 8-10ë¬¸ì¥ í•„ìˆ˜)

ë³€ê²½ëœ ì»´í¬ë„ŒíŠ¸ê°€ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” íŒŒì¼ë“¤ì„ ë¶„ì„í–ˆì„ ë•Œ, **êµ¬ì²´ì ìœ¼ë¡œ** ì–´ë–¤ ê¸°ëŠ¥ê³¼ í™”ë©´ì„ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ëŠ”ì§€ ìƒì„¸íˆ ì„¤ëª…í•˜ì„¸ìš”.

**ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ë‚´ìš©:**
- ì •í™•í•œ í˜ì´ì§€ ê²½ë¡œì™€ URL (ì˜ˆ: /admin/experiences, /blog/list ë“±)
- í…ŒìŠ¤íŠ¸í•´ì•¼ í•  ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ 3-4ê°€ì§€ (ë‹¨ê³„ë³„ë¡œ ìƒì„¸íˆ)
- í™•ì¸í•´ì•¼ í•  Props ì¡°í•©ê³¼ ìƒíƒœ ë³€í™” (êµ¬ì²´ì ì¸ Propsëª… ì–¸ê¸‰)
- ìµœì†Œ 3ê°€ì§€ ì´ìƒì˜ ì—£ì§€ ì¼€ì´ìŠ¤ (ì˜ˆ: ë¹ˆ ë°°ì—´, 100ê°œ ì´ìƒ ë°ì´í„°, null ê°’ ë“±)
- íŠ¹ì • ë¸Œë¼ìš°ì €ë‚˜ í™”ë©´ í¬ê¸°ì—ì„œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•  ì‚¬í•­

**ì¢‹ì€ ì˜ˆì‹œ:**
"DataTable.tsxì˜ ë³€ê²½ì€ src/pages/admin/ExperienceList.tsx, src/pages/admin/PersonalExperience.tsx, src/components/challenge/ParticipantsList.tsx ë“± ì´ 12ê°œ íŒŒì¼ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.

ë¨¼ì € ê´€ë¦¬ì í˜ì´ì§€(/admin/experiences)ì—ì„œ ë‹¤ìŒì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:
1) ì²´í¬ë°•ìŠ¤ë¡œ 10ê°œ í•­ëª© ì„ íƒ í›„ ì „ì²´ ì„ íƒ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë“  í•­ëª©ì´ ì„ íƒë˜ëŠ”ì§€ í™•ì¸
2) 100ê°œ ì´ìƒì˜ ë°ì´í„°ê°€ ìˆì„ ë•Œ í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ì²´í¬ë°•ìŠ¤ ì„ íƒì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
3) selectedRowIds, onSelectionChange, onRowClick Propsê°€ ëª¨ë‘ ì „ë‹¬ë˜ëŠ” ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

íŠ¹íˆ ì£¼ì˜í•´ì•¼ í•  ì—£ì§€ ì¼€ì´ìŠ¤:
- ë°ì´í„°ê°€ ë¹ˆ ë°°ì—´([])ì¼ ë•Œ ì²´í¬ë°•ìŠ¤ê°€ í‘œì‹œë˜ì§€ ì•Šì•„ì•¼ í•¨
- isDisabledê°€ trueì¸ í–‰ì€ ì„ íƒë˜ì§€ ì•Šì•„ì•¼ í•¨
- expandedRows ìƒíƒœì™€ selectedRowIdsê°€ ë™ì‹œì— ë³€ê²½ë  ë•Œ ë Œë”ë§ ì´ìŠˆ í™•ì¸

ëª¨ë°”ì¼ í™˜ê²½(375px ë„ˆë¹„)ì—ì„œ sticky ì²´í¬ë°•ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ê³ ì •ë˜ëŠ”ì§€ Chrome, Safari, Firefoxì—ì„œ ê°ê° í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”."

ìœ„ ì˜ˆì‹œì²˜ëŸ¼ **ë§¤ìš° êµ¬ì²´ì ì´ê³  ìƒì„¸í•˜ê²Œ** 8-10ë¬¸ì¥ ì´ìƒ ì‘ì„±í•˜ì„¸ìš”.

---

### âš ï¸ ì ì¬ì  ìœ„í—˜ (ìµœì†Œ 8-10ë¬¸ì¥ í•„ìˆ˜)

ê³µí†µ ì»´í¬ë„ŒíŠ¸ ë³€ê²½ì´ ì¼ìœ¼í‚¬ ìˆ˜ ìˆëŠ” **êµ¬ì²´ì ì¸ ìœ„í—˜**ì„ íŒŒì¼ëª…ê³¼ ì½”ë“œ ìœ„ì¹˜ë¥¼ í¬í•¨í•´ì„œ ì„¤ëª…í•˜ì„¸ìš”.

**ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ë‚´ìš©:**
- ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„± ë¬¸ì œ (êµ¬ì²´ì ì¸ íŒŒì¼ëª…ê³¼ ë¼ì¸ ë²ˆí˜¸)
- ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„± (ì–´ë–¤ í•¨ìˆ˜, ì–´ë–¤ ìƒí™©ì—ì„œ)
- íƒ€ì… ì•ˆì •ì„± ì´ìŠˆ (ì–´ë–¤ íƒ€ì…, ì–´ë–¤ Props)
- íŠ¹ì • ë¸Œë¼ìš°ì €/í™˜ê²½ì—ì„œì˜ ë¬¸ì œ
- ìµœì†Œ 3-4ê°€ì§€ êµ¬ì²´ì ì¸ ë¦¬ìŠ¤í¬ ì‹œë‚˜ë¦¬ì˜¤

**ì¢‹ì€ ì˜ˆì‹œ:**
"DataTable.tsxì˜ cellRenderer Props íƒ€ì… ë³€ê²½ì€ 12ê°œ íŒŒì¼ì— ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ ë‹¤ìŒ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤:

1) íƒ€ì… ì•ˆì •ì„±: ExperienceList.tsx:45, PersonalExperience.tsx:78ì—ì„œ cellRendererì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì „ì²´ row ê°ì²´ë¥¼ ë°›ëŠ”ë°, ê¸°ì¡´ ì½”ë“œê°€ valueë§Œ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤ë©´ TypeScript ì»´íŒŒì¼ ì—ëŸ¬ëŠ” ì—†ì§€ë§Œ ëŸ°íƒ€ì„ì—ì„œ undefined ì°¸ì¡°ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2) ì„±ëŠ¥: toggleExpandRow (line 47-57)ì™€ toggleRowSelection (line 60-67)ì´ ë§¤ ë Œë”ë§ë§ˆë‹¤ ìƒˆ í•¨ìˆ˜ë¡œ ìƒì„±ë©ë‹ˆë‹¤. 1000ê°œ ì´ìƒì˜ í–‰ì´ ìˆì„ ë•Œ ExpandableCellì— ì „ë‹¬ë˜ëŠ” onToggleExpandê°€ ë§¤ë²ˆ ì¬ìƒì„±ë˜ì–´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ìœ ë°œí•©ë‹ˆë‹¤. useMemoë‚˜ useCallbackìœ¼ë¡œ ìµœì í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.

3) ë©”ëª¨ë¦¬ ëˆ„ìˆ˜: expandedRows (line 44)ê°€ Setìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ”ë°, ë°ì´í„°ê°€ ë³€ê²½ë˜ì–´ë„ Setì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ì´ë™í•˜ê±°ë‚˜ í•„í„°ë¥¼ ë³€ê²½í•´ë„ ì´ì „ IDë“¤ì´ ë‚¨ì•„ìˆì–´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4) ë¸Œë¼ìš°ì € í˜¸í™˜ì„±: sticky left-0 (line 102, 147)ê°€ Safari 13 ì´í•˜ì—ì„œ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. z-indexì™€ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ íŠ¹íˆ ë¬¸ì œê°€ ë©ë‹ˆë‹¤."

ìœ„ ì˜ˆì‹œì²˜ëŸ¼ **êµ¬ì²´ì ì¸ íŒŒì¼ëª…, ë¼ì¸ ë²ˆí˜¸, í•¨ìˆ˜ëª…ì„ í¬í•¨í•´ì„œ** 8-10ë¬¸ì¥ ì´ìƒ ì‘ì„±í•˜ì„¸ìš”.

---

### ğŸ”§ ê°œì„  ì œì•ˆ (ìµœì†Œ 8-10ë¬¸ì¥ í•„ìˆ˜)

ì´ë²ˆ ë³€ê²½ì„ ê¸°íšŒë¡œ í•¨ê»˜ ê°œì„ í•˜ë©´ ì¢‹ì„ ë¶€ë¶„ì„ **êµ¬ì²´ì ì¸ ì½”ë“œì™€ í•¨ê»˜** ì œì•ˆí•˜ì„¸ìš”.

**ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ë‚´ìš©:**
- ì¤‘ë³µ ì½”ë“œ ìœ„ì¹˜ì™€ ê°œì„  ë°©ë²• (íŒŒì¼ëª…, ë¼ì¸ ë²ˆí˜¸)
- íƒ€ì… ì•ˆì •ì„± ê°•í™” ë°©ë²• (êµ¬ì²´ì ì¸ íƒ€ì… ì •ì˜)
- ì„±ëŠ¥ ìµœì í™” ë°©ë²• (ì–´ë–¤ í•¨ìˆ˜ì— useMemo/useCallback ì ìš©)
- ì½”ë“œ ê°€ë…ì„± ê°œì„  (êµ¬ì²´ì ì¸ ë¦¬íŒ©í† ë§ ì œì•ˆ)
- ìµœì†Œ 3-4ê°€ì§€ êµ¬ì²´ì ì¸ ê°œì„  ë°©ì•ˆ

---

### ğŸ“ ë¬¸ì„œí™” (ìµœì†Œ 8-10ë¬¸ì¥ í•„ìˆ˜)

ì½”ë“œ ë³€ê²½ì— ë”°ë¼ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ë¬¸ì„œë¥¼ **êµ¬ì²´ì ì¸ ê²½ë¡œì™€ ë‚´ìš©ì„ í¬í•¨í•´ì„œ** ë‚˜ì—´í•˜ì„¸ìš”.

**ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ë‚´ìš©:**
- ì—…ë°ì´íŠ¸í•´ì•¼ í•  READMEë‚˜ ë¬¸ì„œ íŒŒì¼ì˜ ì •í™•í•œ ê²½ë¡œ
- ì¶”ê°€í•´ì•¼ í•  JSDoc ìœ„ì¹˜ (íŒŒì¼ëª…ê³¼ í•¨ìˆ˜ëª…)
- ì‘ì„±í•´ì•¼ í•  ì‚¬ìš© ì˜ˆì‹œë‚˜ ì½”ë“œ ìŠ¤ë‹ˆí«
- íƒ€ì… ì •ì˜ì— í•„ìš”í•œ ì„¤ëª…

---

**âš ï¸ ë‹¤ì‹œ í•œë²ˆ ê°•ì¡°: ê° ì„¹ì…˜ë§ˆë‹¤ ìµœì†Œ 8-10ë¬¸ì¥ ì´ìƒ, êµ¬ì²´ì ì¸ íŒŒì¼ëª…ê³¼ ì½”ë“œ ìœ„ì¹˜ë¥¼ í¬í•¨í•´ì„œ ì‘ì„±í•˜ì„¸ìš”. ì§§ê±°ë‚˜ ì¶”ìƒì ì¸ ì‘ë‹µì€ ì ˆëŒ€ ë¶ˆê°€í•©ë‹ˆë‹¤.**"""

          data = {
              "contents": [{
                  "parts": [{"text": prompt}]
              }],
              "generationConfig": {
                  "temperature": 0.7,
                  "maxOutputTokens": 8000
              }
          }

          url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key={api_key}"
          req = urllib.request.Request(url, json.dumps(data).encode('utf-8'), {'Content-Type': 'application/json'})

          try:
              with urllib.request.urlopen(req) as response:
                  result = json.loads(response.read().decode('utf-8'))
                  if 'candidates' in result and len(result['candidates']) > 0:
                      print(result['candidates'][0]['content']['parts'][0]['text'])
                  else:
                      print(f"DEBUG: No candidates in response: {json.dumps(result)}", file=os.sys.stderr)
                      print("")
          except urllib.error.HTTPError as e:
              error_body = e.read().decode('utf-8')
              print(f"HTTP Error {e.code}: {error_body}", file=os.sys.stderr)
              print("")
          except Exception as e:
              print(f"Error: {type(e).__name__}: {e}", file=os.sys.stderr)
              print("")
          PYTHON_SCRIPT

          # Run Python script
          ADVICE=$(python3 /tmp/call_gemini.py 2>&1)

          echo "DEBUG: ADVICE output:"
          echo "$ADVICE"

          if [ -z "$ADVICE" ] || [[ "$ADVICE" == *"Error:"* ]] || [[ "$ADVICE" == *"HTTP Error"* ]]; then
            echo "âŒ AI ì¡°ì–¸ ìƒì„± ì‹¤íŒ¨"
            echo "ì—ëŸ¬ ë‚´ìš©: $ADVICE"
            echo "ai_advice=" >> $GITHUB_OUTPUT
          else
            echo "âœ… AI ì¡°ì–¸ ìƒì„± ì„±ê³µ"
            {
              echo 'ai_advice<<EOF'
              echo "$ADVICE"
              echo 'EOF'
            } >> $GITHUB_OUTPUT
          fi

          rm -f /tmp/call_gemini.py

      - name: Find existing comment
        if: steps.changed-files.outputs.count > 0
        uses: peter-evans/find-comment@v3
        id: find-comment
        with:
          issue-number: ${{ github.event.pull_request.number }}
          comment-author: 'github-actions[bot]'
          body-includes: 'PR ì˜í–¥ ë²”ìœ„ ë¶„ì„'

      - name: Create or update comment
        if: steps.changed-files.outputs.count > 0 && steps.read-report.outputs.report != ''
        uses: peter-evans/create-or-update-comment@v4
        with:
          comment-id: ${{ steps.find-comment.outputs.comment-id }}
          issue-number: ${{ github.event.pull_request.number }}
          edit-mode: replace
          body: |
            ${{ steps.read-report.outputs.report }}
            ${{ steps.ai-analysis.outputs.ai_advice != '' && format('
            ---

            ## ğŸ¤– AI ê¸°ë°˜ ì˜í–¥ ë¶„ì„ ë° ì¡°ì–¸

            {0}

            *ì´ ì¡°ì–¸ì€ Gemini APIë¥¼ í†µí•´ ì˜í–¥ ë²”ìœ„ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*', steps.ai-analysis.outputs.ai_advice) || '' }}

      - name: No changes detected
        if: steps.changed-files.outputs.count == 0
        run: |
          echo "No TypeScript/JavaScript files changed in src directory. Skipping impact analysis."
